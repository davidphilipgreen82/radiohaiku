<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Radiohaiku</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;max-width:720px;margin:36px auto;padding:12px;color:#111}
  h1{font-size:1.4rem;margin-bottom:.2rem}
  p{margin:.2rem 0 1rem 0}
  #haiku{white-space:pre; font-size:2.25rem; padding:16px; border-radius:10px; background:#f4f4f6}
  button{margin-right:.5rem;padding:.5rem .8rem;border-radius:8px;border:1px solid #ccc;background:white;cursor:pointer}
  small{color:#666}
  input[type="text"]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ccc;margin-top:.5rem}
</style>
</head>
<body>
  <h1>RadioHaiku</h1>
  <p>Random haikus from Radiohead lyrics</p>

  <div>
    <button id="generateBtn">Generate haiku</button>
    <button id="copyBtn">Copy haiku</button>
    <button id="randomURLBtn">Share this haiku</button>
  </div>

  <div id="haiku" aria-live="polite">Press Generate →</div>

<span style="display:none">
<!--  <p><small>URL examples (either form works):</small></p>
  <pre><code>index.html?a=OKC1-1&b=OKC1-5&c=OKC3-2
index.html/a=OKC1-1b=OKC1-5c=OKC3-2</code></pre>

  <label>Current resolved parameters (a = 5, b = 7, c = 5):</label>-->
  <input id="paramsView" readonly />
</span>

<script>
// Embedded dataset (from JSON)
const radioheadLines = {
  five: {
    "PH1-1": "Sun and moon and stars",
    "PH1-2": "I could never run",
    "PH1-3": "Why should I believe",
    "PH1-4": "Gonna end so soon",
    "PH1-5": "Me and everything",
    "PH2-1": "Your skin makes me cry",
    "PH2-2": "I don't belong here",
    "PH2-3": "When I'm not around",
    "PH2-4": "Whatever you want",
    "PH3-1": "He knows what he wants",
    "PH3-2": "He wants us to leave",
    "PH4-2": "They won't let me be",
    "PH4-4": "We spit on your son",
    "PH4-5": "We spit on your face",
    "PH4-7": "I can't find the words",
    "PH4-8": "I have a complaint",
    "PH5-1": "Thinking about you",
    "PH5-2": "Your records are here",
    "PH5-3": "But I'm still no one",
    "PH5-4": "Should I still love you",
    "PH5-5": "Still see you in bed",
    "PH5-7": "All the things you got",
    "PH5-8": "All the things you need",
    "PH5-9": "So how can you sleep",
    "PH5-10": "And why should you care",
    "PH5-11": "I bled and I bleed",
    "PH6-1": "And if London burns",
    "PH6-2": "Standing on a beach",
    "PH8-2": "Running out on me",
    "PH8-3": "And I burn all hate",
    "PH8-4": "Not a vegetable",
    "PH9-2": "I'm better off dead",
    "PH10-1": "Strange and creeping doubt",
    "PH10-3": "Even though I might",
    "PH10-4": "Even though I try",
    "PH12-1": "Knit into my heel",
    "PH12-2": "Killing what I feel",
    "PH12-3": "Everything I touch",
    "TB1-11": "Why can't you forget",
    "TB2-2": "The words are coming",
    "TB2-3": "Fall asleep against",
    "TB2-5": "Baby's got the bends",
    "TB3-1": "Two jumps in a week",
    "TB4-2": "The fake plastic earth",
    "TB4-8": "My fake plastic love",
    "TB5-2": "Ground to dust and ash",
    "TB5-3": "Crawling on all fours",
    "TB5-5": "All the children flew",
    "TB7-1": "Can't get the stink off",
    "TB7-3": "Comes like a comet",
    "TB7-6": "You and no-one else",
    "TB8-5": "From my life support",
    "TB8-6": "We are losing it",
    "TB8-8": "Twentieth century bitch",
    "TB8-9": "Just like the last one",
    "TB10-1": "I get home from work",
    "TB10-5": "This is killing me",
    "TB11-1": "It eats me alive",
    "TB11-2": "The big wall bites back",
    "TB11-3": "You sit there and sulk",
    "OKC1-1": "In the next world war",
    "OKC1-2": "I am born again",
    "OKC1-3": "In the neon sign",
    "OKC1-4": "Scrolling up and down",
    "OKC1-7": "In a deep deep sleep",
    "OKC1-8": "Of the innocent",
    "OKC2-3": "Kicking and squealing",
    "OKC2-4": "You don't remember",
    "OKC2-6": "Off with his head, man",
    "OKC2-7": "God loves his children",
    "OKC3-1": "I keep forgetting",
    "OKC3-2": "I live in a town",
    "OKC3-3": "Aliens hover",
    "OKC3-4": "Making home movies",
    "OKC3-6": "I'd tell all my friends",
    "OKC3-7": "Lost it completely",
    "OKC4-2": "We hope that you choke",
    "OKC6-1": "This is what you get",
    "OKC7-1": "Not drinking too much",
    "OKC7-5": "A pig in a cage",
    "OKC8-2": "Somewhere we will meet",
    "OKC10-1": "Bruises that won't heal",
    "OKC12-2": "Like it's seen a ghost",
    "OKC12-3": "No one else would know",
    "OKC12-5": "That's when you see sparks",
    "KA2-3": "We've got heads on sticks",
    "KA4-1": "I go where I please",
    "KA7-3": "Trapdoors that open",
    "KA7-2": "This beautiful world",
    "KA8-3": "Let me hear both sides",
    "KA8-4": "Throw it in the fire",
    "KA8-5": "Take the money run",
    "KA9-3": "A bump on the head",
    "KA9-4": "Where'd you park the car",
    "KA9-5": "Cut the kids in half",
    "KA10-3": "Cheap sex and sad films",
    "KA14-1": "You and whose army",
    "KA14-2": "You and your cronies",
    "KA15-1": "And never look back",
    "KA15-4": "There was no future",
    "KA16-1": "I want you to know",
    "KA16-2": "He's not coming back",
    "KA16-3": "Look into my mouth",
    "KA16-5": "Put him in the pot",
    "KA22-1": "There's a little child",
    "KA22-2": "Running round this house",
    "KA22-3": "And he never leaves",
    "KA23-2": "Opposite branches",
    "KA23-4": "Then I'll come running",
    "KA24-2": "Corner of the street",
    "KA24-3": "Calling after me",
    "KA24-4": "Headlights on full beam",
    "KA24-6": "Coming after me",
    "HTT1-1": "I'll lay down the tracks",
    "HTT1-2": "There is no way out",
    "HTT1-3": "You can scream & you",
    "HTT1-4": "It is too late now",
    "HTT1-5": "Paying attention",
    "HTT1-6": "I get it all wrong",
    "HTT1-7": "Like flies the burgers",
    "HTT1-8": "All hail to the thief",
    "HTT2-1": "We can wipe you out",
    "HTT3-2": "But know right from wrong",
    "HTT3-3": "Sail us to the moon",
    "HTT4-2": "So you're backtracking",
    "HTT6-1": "X will mark the place",
    "HTT6-2": "Like parting the waves",
    "HTT6-3": "There'll be no more lies",
    "HTT7-1": "We want the young blood",
    "HTT7-2": "Are you fracturing",
    "HTT7-3": "Our rivers poisoned",
    "HTT7-4": "We want the sweet meats",
    "HTT8-3": "They will suck you down",
    "HTT8-4": "To the otherside",
    "HTT8-5": "This is the gloaming",
    "HTT9-1": "Waiting to happen",
    "HTT10-1": "With white elephants",
    "HTT10-2": "Little babies' eyes",
    "HTT12-1": "Holding half a head",
    "HTT12-2": "Cheering and waving",
    "HTT12-3": "Strangled beaten up",
    "HTT14-1": "Dragging out your dead",
    "HTT14-2": "Singing I miss you",
    "HTT14-3": "Out pops the cracker",
    "HTT14-4": "Smacks you in the head",
    "HTT14-5": "Knives you in the neck",
    "HTT14-6": "Kicks you in the teeth",
    "HTT14-7": "Step up get the gunge",
    "HTT14-8": "Promise to be good",
    "HTT14-9": "But he calls me up",
    "HTT14-10": "Calls me on the phone",
    "HTT14-11": "Steal all my children",
    "IR1-5": "It comes to us all",
    "IR2-11": "The light's gone for me",
    "IR3-3": "You paint yourself white",
    "IR3-4": "And feel up with noise",
    "IR4-3": "Why should I stay here",
    "IR4-5": "Follow where you lead",
    "IR4-8": "If they get the chance",
    "IR4-9": "And this is my chance",
    "IR4-10": "I'll hit the bottom",
    "IR5-2": "Waiting in the wings",
    "IR5-3": "I'm an animal",
    "IR5-4": "Trapped in your hot car",
    "IR5-5": "I am all the days",
    "IR5-7": "You are all I need",
    "IR5-9": "Lying in the reeds",
    "IR5-12": "I'm just an insect",
    "IR6-4": "In pretty patterns",
    "IR6-7": "It's what you feel now",
    "IR6-9": "Dead from the neck up",
    "IR7-5": "Dare not speak his name",
    "IR8-1": "I don't want to be your friend",
    "IR8-5": "Fall off the table",
    "IR10-5": "You are my center",
    "IR10-6": "When I spin away",
    "IR10-10": "I'm talking to you",
    "IR10-10": "After it's too late"
  },
  seven: {
    "PH1-1": "working out chaotic things",
    "PH1-2": "back to the top",
    "PH2-1": "Whatever makes you happy",
    "PH2-2": "You're so fucking special",
    "PH3-1": "He's a dangerous bigot",
    "PH3-2": "And he's just like his daddy",
    "PH4-0": "I don't wanna hear your voice",
    "PH4-1": "Doesn't matter anyway",
    "PH5-1": "But I'm playing with myself",
    "PH6-1": "I wanna be in a band",
    "PH6-2": "Anyone can play guitar",
    "PH7-0": "clever toys for little boys",
    "PH7-1": "You're free until you drop",
    "PH7-2": "The answer to your prayers",
    "PH7-3": "You're free 'til you've had enough",
    "PH7-4": "On politics and power",
    "PH8-1": "wanted anything but this",
    "PH8-2": "I will not control myself",
    "PH8-3": "I spit on the hand that feeds",
    "PH9-1": "Hook back up to the cathode ray",
    "PH10-1": "Please forget the words that",
    "PH10-2": "It keeps rattling my cage",
    "PH11-1": "Tell me one thing and let it go",
    "PH12-1": "All the time killing what I feel",
    "TB2-2": "To hide all the dirt and pain",
    "TB2-4": "I wish it was the sixties",
    "TB2-5": "I wish we could be happy",
    "TB8-2": "We're too young to fall asleep",
    "TB10-2": "Blame it on the falling sky",
    "TB10-3": "Blame it on the satellite",
    "TB4-3": "She lives with a broken man",
    "TB4-5": "But gravity always wins",
    "TB4-6": "She looks like the real thing",
    "TB4-7": "She tastes like the real thing",
    "TB5-1": "I don't want to be crippled",
    "TB7-2": "He's been hanging round for days",
    "TB7-4": "Suckered you but not your friends",
    "TB8-1": "Faith you're driving me away",
    "TB9-4": "Wish that it was bullet proof",
    "TB9-1": "Limb by limb and tooth by tooth",
    "OKC1-5":"In an interstellar burst",
    "OKC1-6":"Back to save the universe",
    "OKC1-9":"I'm amazed that I survived",
    "OKC2-1":"I'm trying to get some rest",
    "OKC2-2":"Of no consequence at all",
    "OKC2-5":"Don't you remember my name",
    "OKC3-5":"Swoop down in a country lane",
    "OKC4-1":"Before your father hears us",
    "OKC5-1":"The emptiest of feelings",
    "OKC5-2":"It's so so disappointing",
    "OKC5-3":"Let down and hanging around",
    "OKC5-4":"Crushed like a bug in the ground",
    "OKC5-5":"It always ends up drivel",
    "OKC5-6":"Hysterical and useless",
    "OKC7-2":"A patient better driver",
    "OKC7-4":"Like a cat tied to a stick",
    "OKC9-1":"I am the pick in the ice",
    "OKC9-2":"You know we're friends till we die",
    "OKC11-2":"Pull me out of the aircrash",
    "OKC11-3":"Cause I'm your superhero",
    "OKC11-4":"We are standing on the edge",
    "OKC12-4":"Sometimes I get overcharged",
    "KA2-2": "Slipped on a little white lie",
    "KA6-1": "You can try the best you can",
    "KA6-3": "Dinosaurs roaming the Earth",
    "KA8-1": "Everything all of the time",
    "KA8-2": "Everything all of the time",
    "KA9-2": "You can keep the furniture",
    "KA10-2": "Help me get back to your arms",
    "KA10-4": "Help me get where I belong",
    "KA11-3": "As your life flashed before your eyes",
    "KA12-0": "And we all went to heaven",
    "KA12-1": "I jumped in the river",
    "KA12-2": "Black-eyed angels swam with me",
    "KA12-3": "A moon full of stars and astral cars",
    "KA15-5": "Open up begin again",
    "KA15-6": "Let's go down the waterfall",
    "KA18-3": "There are weapons we can use",
    "KA20-1": "While you make pretty speeches",
    "KA20-3": "You feed me to the lions",
    "HTT1-1": "Walk into the jaws of hell",
    "HTT1-2": "We can wipe you out anytime",
    "HTT3-1": "Maybe you'll be president",
    "HTT6-1": "Where I end and you begin",
    "HTT6-2": "The dinosaurs roam the earth",
    "HTT6-3": "And I can't and I can't come down",
    "HTT6-4": "Where I end and where you start",
    "HTT6-5": "Where you, you left me alone",
    "HTT6-6": "I will eat you all alive",
    "HTT7-1": "Are you begging for a break",
    "HTT7-2": "Are you strung up by the wrists",
    "HTT7-3": "Won't let the creeping ivy",
    "HTT8-1": "To the shadows blue and red",
    "HTT9-1": "Waiting waiting to happen",
    "HTT11-1": "I don't know why you bother",
    "HTT11-2": "You had to piss on our parade",
    "HTT12-1": "He said I been where I liked",
    "HTT12-2": "She ate me up for breakfast",
    "HTT13-1": "Somewhere I'm not Scatterbrain",
    "HTT14-1": "If I don't pay the ransom",
    "HTT14-2": "Take it with a pinch of salt",
    "HTT8-1": "We are not the same as you",
    "HTT8-2": "Funny haha funny how",
    "HTT3-1": "Maybe you'll be president",
    "HTT4-1": "I'm teetering on the brink",
    "HTT11-1": "I don't know why you bother",
    "IR4-2": "I get eaten by the worms",
    "IR4-3": "Get picked over by the worms",
    "IR5-1": "Because there are no others",
    "IR6-4": "Duplicate and triplicate",
    "IR7-1": "Dedicated to all you",
    "IR9-7": "Come back and focus again",
    "IR9-8": "You've got a cheshire cat grin",
    "IR9-10": "This place is on a mission",
    "IR9-15": "Words are a sawed off shotgun",
    "IR10-1": "When I'm at the pearly gates",
    "IR10-4": "This is one for the good days",
    "IR7-7": "It ripples our reflections",
    "IR6-5": "Fingers in the blackbird pie",
    "IR6-6": "I'm tingling tingling",
    "IR6-1": "Wakey wakey, rise and shine",
    "IR6-3": "Watch me fall like dominos",
    "IR5-11": "Who just wants to share your light",
    "IR4-11": "Hit the bottom and escape",
    "IR1-6": "It's as soft as your pillow",
    "IR2-10": "Has the light gone out for you",
    "IR2-12": "You can fight it like a dog",
    "IR2-13": "And they brought me to my knees",
    "IR10-2": "No matter what happens now",
    "IR3-1": "Don't get any big ideas",
    "IR3-5": "But there'll be something missing",
    "IR3-6": "Now that you've found it, it's gone",
    "IR3-7": "Now that you feel it, you don't"
  }
};


// Helper: animate a single line with random flashes
function animateLine(syllables, finalLine, lineIndex, callback){
  const display = document.getElementById('haiku');
  let count = 0;
  const interval = setInterval(()=>{
    const randomLine = resolveLine(randomKey(syllables===7 ? radioheadLines.seven : radioheadLines.five), syllables);
    const lines = display.textContent.split('\n');
    lines[lineIndex] = randomLine;
    display.textContent = lines.join('\n');
    count++;
    if(count >= 6){ // 3 flashes ~ 1 second each
      clearInterval(interval);
      const linesFinal = display.textContent.split('\n');
      linesFinal[lineIndex] = finalLine;
      display.textContent = linesFinal.join('\n');
      if(callback) callback();
    }
  }, 50); // ms per flash
}


// Helper: pick random property from an object
function randomKey(obj){
  const keys = Object.keys(obj);
  return keys[Math.floor(Math.random()*keys.length)];
}

// Parse both query-string and path-like short form
function parseParams(){
  const params = {};
  // query string first
  const search = new URLSearchParams(window.location.search);
  if(search.get('a') || search.get('b') || search.get('c')){
    if(search.get('a')) params.a = search.get('a');
    if(search.get('b')) params.b = search.get('b');
    if(search.get('c')) params.c = search.get('c');
    return params;
  }
  // path-like: /a=OKC1-1b=OKC1-5c=OKC3-2
  const path = window.location.pathname || '';
  const parts = path.split('/').filter(Boolean);
  if(parts.length){
    // join last part(s)
    const joined = parts.join('');
    const re = /a=([A-Za-z0-9-]+)|b=([A-Za-z0-9-]+)|c=([A-Za-z0-9-]+)/g;
    let m;
    while((m = re.exec(joined)) !== null){
      if(m[1]) params.a = m[1];
      if(m[2]) params.b = m[2];
      if(m[3]) params.c = m[3];
    }
  }
  // also allow hash-based params like #a=OKC...
  const hash = window.location.hash.replace(/^#/,'');
  if(hash){
    const pairs = new URLSearchParams(hash);
    if(pairs.get('a')) params.a = pairs.get('a');
    if(pairs.get('b')) params.b = pairs.get('b');
    if(pairs.get('c')) params.c = pairs.get('c');
  }
  return params;
}

function resolveLine(id, syllables){
  // syllables = 5 or 7
  if(!id) return null;
  const store = syllables===7 ? radioheadLines.seven : radioheadLines.five;
  return store[id] || null;
}

function showResolvedParamsView(a,b,c){
  document.getElementById('paramsView').value = `a=${a||''}  b=${b||''}  c=${c||''}`;
}

function buildHaikuFromIDs(aID,bID,cID){
  const a = resolveLine(aID,5);
  const b = resolveLine(bID,7);
  const c = resolveLine(cID,5);
  if(a && b && c){
    return `${a}\n${b}\n${c}`;
  }
  return null;
}

function generateRandomHaiku(){
  const aID = randomKey(radioheadLines.five);
  const bID = randomKey(radioheadLines.seven);
  const cID = randomKey(radioheadLines.five);
  const haiku = `${radioheadLines.five[aID]}\n${radioheadLines.seven[bID]}\n${radioheadLines.five[cID]}`;
  showResolvedParamsView(aID,bID,cID);
  return {haiku, ids: {a:aID,b:bID,c:cID}};
}

function render(haikuText){
  document.getElementById('haiku').textContent = haikuText;
}

// OPTION 1
// NON-FLASHER
/* document.getElementById('generateBtn').addEventListener('click', ()=>{
  const {haiku, ids} = generateRandomHaiku();
  render(haiku);
  // update URL (shallow) to include chosen ids as query params for sharing
  const newUrl = `${location.pathname}?a=${ids.a}&b=${ids.b}&c=${ids.c}`;
  history.replaceState(null,'',newUrl);
});
*/
//NON-FLASHER ENDS

// OPTION 2
// FLASHER
document.getElementById('generateBtn').addEventListener('click', ()=>{
  const {haiku, ids} = generateRandomHaiku();
  const [line1, line2, line3] = haiku.split('\n');

  // Clear current haiku
  render('\n\n');

  // Animate each line in sequence
  animateLine(5, line1, 0, ()=>{
    animateLine(7, line2, 1, ()=>{
      animateLine(5, line3, 2);
    });
  });

  // update URL (shallow) to include chosen ids as query params for sharing
  const newUrl = `${location.pathname}?a=${ids.a}&b=${ids.b}&c=${ids.c}`;
  history.replaceState(null,'',newUrl);
});
// FLASHER ENDS


document.getElementById('copyBtn').addEventListener('click', async ()=>{
  const txt = document.getElementById('haiku').textContent;
  try{
    await navigator.clipboard.writeText(txt);
    alert('Haiku copied to clipboard');
  }catch(e){
    alert('Copy failed — you can manually select and copy the text');
  }
});

document.getElementById('randomURLBtn').addEventListener('click', ()=>{
  const {ids} = generateRandomHaiku();
  const share = `${location.origin}${location.pathname}?a=${ids.a}&b=${ids.b}&c=${ids.c}`;
  prompt('Shareable URL (copy):', share);
});

// On load: if params present, try to render those; otherwise show instructions
(function init(){
  const p = parseParams();
  let a = p.a || null;
  let b = p.b || null;
  let c = p.c || null;

  // If we have explicit ids and they resolve, render those.
  if(a && b && c){
    const haiku = buildHaikuFromIDs(a,b,c);
    if(haiku){
      render(haiku);
      showResolvedParamsView(a,b,c);
      return;
    } else {
      // if invalid id(s), fall through to random
      console.warn('One or more IDs in URL did not resolve; generating random haiku instead.');
    }
  }

  // If no valid params, show a random haiku on load
  const {haiku, ids} = generateRandomHaiku();
  render(haiku);
  // reflect chosen ids in the readonly field and URL
  showResolvedParamsView(ids.a, ids.b, ids.c);
  history.replaceState(null,'', `${location.pathname}?a=${ids.a}&b=${ids.b}&c=${ids.c}`);
})();
</script>


</body>
</html>

